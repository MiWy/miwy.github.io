<!DOCTYPE html>
<html lang="pl-pl">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>[OLD] Java 101: Enum &#43; Servlets - Michał Wyrwa</title><meta name="Description" content=""><meta property="og:title" content="[OLD] Java 101: Enum &#43; Servlets" />
<meta property="og:description" content="[This is a post from my old website. Outdated packages and libraries. Viewer discretion is advised ;-)]
ENUM Typ enum, dodany w wersji 1.5, służy do definiowania stałych. Kiedy mamy z nim do czynienia, to wiemy że mamy do wyboru ograniczony zbiór możliwych opcji. Przykładowo, definiując enum poraRoku z góry wiemy, że będzie on przyjmować wartości jedynie spośród ZIMA, WIOSNA, LATO i JESIEN.
Każdy enum domyślnie rozszerza klasę java.lang.Enum, dlatego nie może rozszerzać żadnej innej klasy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://michalwyrwa.org/posts/2017-07-06-enumsql/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-07-06T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[OLD] Java 101: Enum &#43; Servlets"/>
<meta name="twitter:description" content="[This is a post from my old website. Outdated packages and libraries. Viewer discretion is advised ;-)]
ENUM Typ enum, dodany w wersji 1.5, służy do definiowania stałych. Kiedy mamy z nim do czynienia, to wiemy że mamy do wyboru ograniczony zbiór możliwych opcji. Przykładowo, definiując enum poraRoku z góry wiemy, że będzie on przyjmować wartości jedynie spośród ZIMA, WIOSNA, LATO i JESIEN.
Każdy enum domyślnie rozszerza klasę java.lang.Enum, dlatego nie może rozszerzać żadnej innej klasy."/>
<meta name="application-name" content="Michał Wyrwa">
<meta name="apple-mobile-web-app-title" content="Michał Wyrwa"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://michalwyrwa.org/posts/2017-07-06-enumsql/" /><link rel="prev" href="https://michalwyrwa.org/posts/2017-05-17-android_courier_firebase/" /><link rel="next" href="https://michalwyrwa.org/posts/2017-09-13-spotibar/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[OLD] Java 101: Enum + Servlets",
        "inLanguage": "pl-pl",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/michalwyrwa.org\/posts\/2017-07-06-enumsql\/"
        },"genre": "posts","wordcount":  2031 ,
        "url": "https:\/\/michalwyrwa.org\/posts\/2017-07-06-enumsql\/","datePublished": "2017-07-06T00:00:00+00:00","dateModified": "2017-07-06T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "mw"},"author": {
                "@type": "Person",
                "name": "mw"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Michał Wyrwa">Michał Wyrwa</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/research/"><i class='fas fa-copy'></i> research </a><a class="menu-item" href="/categories/blog/"><i class='fas fa-quote-right'></i> blog </a><a class="menu-item" href="/categories/classes/"><i class='fas fa-user-graduate'></i> teaching </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Michał Wyrwa">Michał Wyrwa</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/research/" title=""><i class='fas fa-copy'></i>research</a><a class="menu-item" href="/categories/blog/" title=""><i class='fas fa-quote-right'></i>blog</a><a class="menu-item" href="/categories/classes/" title=""><i class='fas fa-user-graduate'></i>teaching</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">[OLD] Java 101: Enum &#43; Servlets</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>mw</a></span>&nbsp;<span class="post-category">included in <a href="/categories/blog/"><i class="far fa-folder fa-fw"></i>blog</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="6060-09-78">6060-09-78</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2031 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;10 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#enum">ENUM</a>
          <ul>
            <li><a href="#kiedy-stosować">Kiedy stosować?</a></li>
          </ul>
        </li>
        <li><a href="#prosta-aplikacja-webowa-servlets-tomcat">Prosta aplikacja webowa: Servlets, Tomcat</a>
          <ul>
            <li><a href="#przygotowania">Przygotowania*</a></li>
            <li><a href="#servlet-pobierający-informacje-z-bazy-danych">Servlet pobierający informacje z bazy danych</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>[This is a post from my old website. Outdated packages and libraries. Viewer discretion is advised ;-)]</p>
<h2 id="enum">ENUM</h2>
<p>Typ <strong>enum</strong>, dodany w wersji 1.5, służy do definiowania stałych. Kiedy mamy z nim do czynienia, to wiemy że mamy do wyboru ograniczony zbiór możliwych opcji. Przykładowo, definiując enum <code>poraRoku</code> z góry wiemy, że będzie on przyjmować wartości jedynie spośród <em><code>ZIMA</code></em>, <em><code>WIOSNA</code></em>, <em><code>LATO</code></em> i <em><code>JESIEN</code></em>.</p>
<p>Każdy enum domyślnie rozszerza klasę <code>java.lang.Enum</code>, dlatego nie może rozszerzać żadnej innej klasy. Może natomiast implementować interfejsy. Enumy możemy definiować również jako klasy wewnętrzne.</p>
<p>Konstruktor może być <code>protected</code> (domyślnie) albo <code>private</code>. Nie przywołujemy go bezpośrednio. Weźmy nasz enum <code>poraRoku</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="kd">class</span> <span class="nc">EnumCwiczenie</span> <span class="o">{</span>
      <span class="kd">enum</span> <span class="n">poraRoku</span> <span class="o">{</span>
        <span class="n">ZIMA</span><span class="o">,</span> <span class="n">WIOSNA</span><span class="o">,</span> <span class="n">LATO</span><span class="o">,</span> <span class="n">JESIEN</span>
      <span class="o">}</span>

      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">poraRoku</span><span class="o">.</span><span class="na">LATO</span> <span class="o">+</span> <span class="s">&#34; to okres strasznej duchoty.&#34;</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Efekt: <code>LATO to okres strasznej duchoty.</code></p>
<p>Ciało klasy (<em>typu</em>) enum może zawierać metody i inne pola. Domyślnie w trakcie kompilacji dodawana jest metoda <code>values()</code>, zwracająca tablicę wszystkich wartości naszego enum w kolejności ich deklaracji w kodzie. Zobaczmy jak możemy zawrzeć więcej informacji w stałych enum:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="kd">class</span> <span class="nc">EnumCwiczenie</span> <span class="o">{</span>
      <span class="kd">enum</span> <span class="n">poraRoku</span> <span class="o">{</span>
        <span class="n">ZIMA</span><span class="o">(</span><span class="s">&#34;Gwiazdka&#34;</span><span class="o">),</span> <span class="n">WIOSNA</span><span class="o">(</span><span class="s">&#34;Wielkanoc&#34;</span><span class="o">),</span> <span class="n">LATO</span><span class="o">(</span><span class="s">&#34;Noc Kupaly&#34;</span><span class="o">),</span> <span class="n">JESIEN</span><span class="o">(</span><span class="s">&#34;Zaduszki&#34;</span><span class="o">);</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">waznaData</span><span class="o">;</span>

        <span class="n">poraRoku</span><span class="o">(</span><span class="n">String</span> <span class="n">waznaData</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">waznaData</span> <span class="o">=</span> <span class="n">waznaData</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">String</span> <span class="nf">getWaznaData</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">waznaData</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>

      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">poraRoku</span><span class="o">.</span><span class="na">LATO</span> <span class="o">+</span> <span class="s">&#34; to okres strasznej duchoty.&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;W trakcie tej pory roku ma miejsce &#34;</span> <span class="o">+</span> <span class="n">poraRoku</span><span class="o">.</span><span class="na">LATO</span><span class="o">.</span><span class="na">getWaznaData</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.&#34;</span><span class="o">);</span>

        <span class="k">for</span><span class="o">(</span><span class="n">poraRoku</span> <span class="n">pora</span> <span class="o">:</span> <span class="n">poraRoku</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;W trakcie pory &#34;</span> <span class="o">+</span> <span class="n">pora</span> <span class="o">+</span> <span class="s">&#34; ma miejsce &#34;</span> <span class="o">+</span> <span class="n">pora</span><span class="o">.</span><span class="na">getWaznaData</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.&#34;</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Efekt:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">    LATO to okres strasznej duchoty.
    W trakcie tej pory roku ma miejsce Noc Kupaly.
    W trakcie pory ZIMA ma miejsce Gwiazdka.
    W trakcie pory WIOSNA ma miejsce Wielkanoc.
    W trakcie pory LATO ma miejsce Noc Kupaly.
    W trakcie pory JESIEN ma miejsce Zaduszki.
</code></pre></td></tr></table>
</div>
</div><p>Pełen zbiór domyślnych metod znaleźć można w <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Enum.html" target="_blank" rel="noopener noreffer">dokumentacji</a>.</p>
<h3 id="kiedy-stosować">Kiedy stosować?</h3>
<p>Korzystając z enuma, mamy zagwarantowane istnienie tylko jednej instancji stałej (wygodny punkt wyjścia dla wzorca <a href="http://keaplogik.blogspot.com/2013/12/the-java-enum-singleton-pattern.html" target="_blank" rel="noopener noreffer">Singleton</a>). Ponadto, możemy korzystać z operatora <code>==</code>. Zawarta w klasie <code>Enum</code> metoda <code>equals()</code> działa dokładnie tak samo jak ten operator, ale jest metodą, więc możemy otrzymać wyjątek <code>NullPointerException</code>, zamiast wartości <code>false</code> jak w przypadku porównania enum przy pomocy <code>==</code> z <code>null</code>.</p>
<p>Nie trzeba implementować interfejsu <code>Serializable</code> by móc serializować enumy. Ponadto, dokonując serializacji enuma, <em>de facto</em> serializowana jest jego nazwa, zwracana przez wbudowaną metodę <code>name()</code>, a przy deserializacji przywoływana jest metoda <code>valueOf()</code> naszego enuma, zwracająca stałą o tej nazwie. W ten sposób nie musimy serializować wartości wszytkich pól enuma.</p>
<p>Enumy pozwalają także na wygodniejsze stosowanie wyrażeń <code>switch</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="n">poraRoku</span> <span class="n">jednaPoraRoku</span> <span class="o">=</span> <span class="n">poraRoku</span><span class="o">.</span><span class="na">WIOSNA</span><span class="o">;</span>
    <span class="k">switch</span><span class="o">(</span><span class="n">jednaPoraRoku</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">LATO</span><span class="o">:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Cieplo!&#34;</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="n">ZIMA</span><span class="o">:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Zimno!&#34;</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="n">WIOSNA</span><span class="o">:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;W sam raz!&#34;</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="n">JESIEN</span><span class="o">:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Mokro!&#34;</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Efekt: <code>W sam raz!</code></p>
<p>Nie zawsze stosowanie typu enum jest korzystne. Zajmują one więcej miejsca w pamięci (powód dla którego ich stosowanie <a href="https://developer.android.com/topic/performance/memory.html#Overhead" target="_blank" rel="noopener noreffer">nie jest rekomendowane</a> przez zespół Androida). Jeżeli nasze stałe nie mają żadnych dodatkowych pól, to prawdopodobnie mniej zasobów będzie zajmować zwyczajowe <code>public static final</code>.
Z drugiej strony, enumy są łatwym sposobem obsługi stałych, które mają posiadać dodatkowe pola (a zatem więcej informacji) i własne metody.</p>
<p>Czyli, jak zawsze, stosować w sposób przemyślany ;).</p>
<h2 id="prosta-aplikacja-webowa-servlets-tomcat">Prosta aplikacja webowa: Servlets, Tomcat</h2>
<p>Mówiąc w skrócie, servlety to klasy pomagające serwerowi w odpowiadaniu na żądania ze strony klienta. Jako że najczęściej żądania są w protokole HTTP, to pisząc servlet zwykle rozszerzamy klasę <code>javax.servlet.http.HttpServlet</code>, i nie bawimy się w implementację samego interfejsu <code>javax.servlet.Servlet</code>.</p>
<p>Zwróćcie uwagę na początek tych nazw: java<strong>x</strong>, nie zwykłe java. Standardowa edycja Javy nie zawiera servletów, Jeżeli używaliście wcześniej platformy Javy SE, to będziecie musieli ściągnąć brakujące biblioteki, albo po prostu przerzucić się na Javę EE, która je (i inne) zawiera. Przykładowo, jeśli korzystacie z Eclipse&rsquo;a, macie do wyboru <a href="https://www.eclipse.org/ide/" target="_blank" rel="noopener noreffer">kilka wersji</a> programu. Zainstalujcie <a href="https://www.eclipse.org/downloads/packages/eclipse-ide-java-ee-developers/oxygenr" target="_blank" rel="noopener noreffer">wersję dla Javy EE </a>i będziecie mieć spokój ;).</p>
<p>Potrzebny jest też serwer oraz (akurat dla potrzeb takich servletów, jakie napiszemy) baza danych. W poniższych przykładach wykorzystany jest <a href="http://tomcat.apache.org" target="_blank" rel="noopener noreffer">Tomcat</a> oraz <a href="https://www.mysql.com" target="_blank" rel="noopener noreffer">MySQL</a>. Nie będziemy krok po kroku przerabiać ich instalacji, w internecie bez problemu można znaleźć instrukcje do każdego systemu operacyjnego. Za pierwszym razem może to trochę czasu zająć, szczególnie jeśli się nie miało wcześniej do czynienia z linią komend, ale warto tę chwilę poświęcić. Założenie jest zatem takie, że Tomcat jest zainstalowany, a na dysku utworzona została baza danych MySQL.</p>
<p><code>javax.servlet.http.HttpServlet</code> zawiera <a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html" target="_blank" rel="noopener noreffer">szereg metod</a> odpowiadającym żądaniom HTTP. Skorzystamy z metod <code>doGet()</code> oraz <code>doPost()</code>. Różnica pomiędzy GET a POST polega na widoczności przesyłanych danych. Żądanie GET zawiera przesyłane do serwera informacje w adresie URL (można więc podejrzeć je nawet w historii przeglądarki), stąd dane muszą być zapisane za pomocą znaków ASCII. Przeglądarki i serwery nakładają ograniczenia na maksymalną długość adresu URL (od 2048 w górę), więc i z tej perspektywy jesteśmy ograniczeni. Dla żądania POST format danych nie jest tak istotny.</p>
<p>Napiszemy bardzo prostą aplikację webową: pamiętnik operujący na lokalnym serwerze.</p>
<h3 id="przygotowania">Przygotowania*</h3>
<p>(*Eclipse, wszystko można zrobić bez pomocy IDE)</p>
<p>Potrzebny jest nam nowy projekt, skonfigurowany do działania na serwerze. W Eclipse klikamy **File **-&gt; **New **-&gt; <strong>Dynamic Web Project</strong>. Po podaniu nazwy projektu, obok pola <em>Target runtime</em> klikamy przycisk <em>New Runtime&hellip;</em>, wybieramy wersję Tomcata, klikamy <em>Finish</em>. Kreator projektu również zamykamy klikając <em>Finish</em>. Ok, mamy lokalny serwer, na którym będziemy odpalać nasze servlety.</p>
<p>Teraz baza danych. Upewnij się, że masz włączony domyślną perspektywę w Eclipse (_Window _-&gt; <em>Perspective</em> -&gt; <em>Open perspective</em> -&gt; <em>Java EE</em>). U dołu okna IDE kliknij w <em>Data Source Explorer</em> i prawym przycikiem myszy na <em>Database Connections</em>. Kliknij <em>New</em>, z listy wybierz MySQL. Po naciśnięciu <em>Next</em> wpisz dane do swojej bazy danych (nazwa pod polem <em>Database</em>, pełen URL, login i hasło). Jeżeli po naciśnięciu <em>Test Connection</em> pokazuje się komunikat o niepowodzeniu, sprawdź wybrany sterownik. W naszym wypadku jest to JDBC Driver, ściągnąć go można <a href="https://www.mysql.com/products/connector/" target="_blank" rel="noopener noreffer">tutaj.</a> a zmienić naciskając na ikonę trójkąta po prawej strony od listy sterowników, wskazując na miejsce, gdzie tenże .jar znajduje się na dysku.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/oldblog/20-07_servlet_databasedriver.png"
        data-srcset="/images/oldblog/20-07_servlet_databasedriver.png, /images/oldblog/20-07_servlet_databasedriver.png 1.5x, /images/oldblog/20-07_servlet_databasedriver.png 2x"
        data-sizes="auto"
        alt="/images/oldblog/20-07_servlet_databasedriver.png"
        title="image-center" />{: .align-center}</p>
<p>W naszym wypadku baza danych nazywa się <code>diary</code>, a przygotowana wcześniej tabela <code>ENTRIES</code>, z następującymi kolumnami:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ENTRIES</span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="nb">date</span><span class="w"> </span><span class="n">DATETIME</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">content</span><span class="w"> </span><span class="n">LONGTEXT</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="servlet-pobierający-informacje-z-bazy-danych">Servlet pobierający informacje z bazy danych</h3>
<p>Tak jak wyżej napisano, servlety służące do obsługi żądań HTTP powinny rozszerzać klasę <code>javax.servlet.http.HttpServlet</code>. A więc:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="nd">@WebServlet</span><span class="o">(</span><span class="s">&#34;/DiaryArchive&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">DiaryArchive</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Kilka słów o <a href="http://docs.oracle.com/javaee/7/api/javax/servlet/annotation/WebServlet.html" target="_blank" rel="noopener noreffer"><code>@WebServlet</code></a>. Pojawiła się ona w specyfikacji <a href="http://download.oracle.com/otn-pub/jcp/servlet-3.0-fr-eval-oth-JSpec/servlet-3_0-final-spec.pdf?AuthParam=1500537336_edf2e70ab23c230015d7612efce60f3d" target="_blank" rel="noopener noreffer">Servlet 3.0</a>. Wcześniej dla każdej aplikacji sieciowej obsługiwanej przy pomocy servletów należało tworzyć deskryptor w pliku <code>web.xml</code>, w którym m.in. umieszczaliśmy informacje na temat wszystkich servletów. Dzięki temu kontener servletów (w naszym przypadku Tomcat) wiedział, który servlet powinien odpalić na dany typ żądania ze strony klienta. Adnotacja <code>@WebServlet</code> ułatwia nam pracę, takowego pliku przygotowywać nie trzeba (Tomcat ją obsługuje od wersji 7.0).</p>
<p>W dokumentacji wymieniony jest szereg atrybutów adnotacji, ale podawać trzeba jedynie <code>urlPatterns</code>/<code>value</code>, wskazując URL pod którym nasz servlet będzie aktywny.</p>
<p>Nasz pierwszy servlet będzie służyć do odczytywania z bazy danych wpisów z pamiętnika. Żadnych specjalnych danych do serwera nie przesyłamy, tylko żądanie wyświetlenia wpisów, więc skorzystamy z żądania GET, a więc przesłaniamy metodę <code>doGet()</code>. Od razu ustalimy typ odpowiedzi (będzie to wyświetlany w przeglądarce html) oraz przygotujemy przypiszemy zmienną <strong>out</strong> do obiektu <code>PrintWriter</code> wziętego z <code>HttpServletResponse</code>. Ten posłuży nam do przesłania tekstu (kodu html) do klienta:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> 
          <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
                    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">&#34;text/html&#34;</span><span class="o">);</span>
                    <span class="n">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Czas na małe parsowanie. Najpierw część kodu html, do którego nie potrzebujemy informacji z bazy danych:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;My Db Diary&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">docType</span> <span class="o">=</span>  <span class="s">&#34;&lt;!DOCTYPE html&gt;\n&#34;</span><span class="o">;</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">docType</span> <span class="o">+</span> 
        <span class="s">&#34;&lt;html&gt;\n&#34;</span> <span class="o">+</span>
        <span class="s">&#34;&lt;head&gt;&lt;title&gt;&#34;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">&#34;&lt;/title&gt;&lt;/header&gt;\n&#34;</span> <span class="o">+</span>
        <span class="s">&#34;&lt;body bgcolor = \&#34;#f3f3f3\&#34;&gt;\n&#34;</span> <span class="o">+</span>
        <span class="s">&#34;&lt;h1 align = \&#34;center\&#34;&gt;&#34;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">&#34;&lt;/h1&gt;\n&#34;</span> <span class="o">+</span>
        <span class="s">&#34;&lt;h3 align = \&#34;center\&#34;&gt;&lt;a href=\&#34;http://localhost:8080/DiaryServlet/DiaryMain.html\&#34;&gt;Add new entry&lt;/a&gt;&lt;/h3&gt;&#34;</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Od razu zawarliśmy w nim URL, pod którym będzie działać nasz drugi servlet. Na razie wejście pod ten adres wywołałoby jedynie błędy.</p>
<p>Pozostaje nam połączenie się z bazą danych, pobranie wpisów i sparsowanie ich do kodu HTML. Najpierw kilka stałych:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">JDBC_DRIVER</span> <span class="o">=</span> <span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DB_URL</span> <span class="o">=</span> <span class="s">&#34;jdbc:mysql://localhost:3306/diary&#34;</span><span class="o">;</span>  <span class="c1">// Adres naszej bazy MySQL
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER</span> <span class="o">=</span> <span class="s">&#34;root&#34;</span><span class="o">;</span> <span class="c1">// Login do bazy
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PASS</span> <span class="o">=</span> <span class="s">&#34;root&#34;</span><span class="o">;</span> <span class="c1">// Hasło do bazy
</span><span class="c1"></span>
    <span class="k">try</span> <span class="o">{</span>	
      <span class="c1">// Rejestrujemy sterownik.
</span><span class="c1"></span>      <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">JDBC_DRIVER</span><span class="o">);</span>

            <span class="c1">// Podłączamy się do naszej bazy MySQL
</span><span class="c1"></span>      <span class="n">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">DB_URL</span><span class="o">,</span> <span class="n">USER</span><span class="o">,</span> <span class="n">PASS</span><span class="o">);</span>

            <span class="c1">// Przygotowujemy zapytanie do bazy oraz obiekt klasy ResultSet z danymi zwrotnymi.
</span><span class="c1"></span>      <span class="n">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
      <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&#34;SELECT id, date, title, content FROM ENTRIES&#34;</span><span class="o">;</span>
      <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>

            <span class="c1">// Parsujemy każdy kolejny wiersz pobrany do obiektu ResultSet do kodu HTML.
</span><span class="c1"></span>      <span class="k">while</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="n">Timestamp</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getTimestamp</span><span class="o">(</span><span class="s">&#34;date&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">entryTitle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;title&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">entryContent</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;content&#34;</span><span class="o">);</span>

        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;&lt;h3 align = \&#34;center\&#34;&gt;&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="n">ts</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;&lt;/h3&gt;&#34;</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;&lt;h2 align = \&#34;center\&#34;&gt;&#34;</span> <span class="o">+</span> <span class="n">entryTitle</span> <span class="o">+</span> <span class="s">&#34;&lt;/h2&gt;&lt;br&gt;&#34;</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entryContent</span> <span class="o">+</span> <span class="s">&#34;&lt;br&gt;&#34;</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;&lt;/body&gt;&lt;/html&gt;&#34;</span><span class="o">);</span>
      
            <span class="c1">// Zamykamy połączenia z bazą danych (dla przejrzystości przykładu zakładamy, że nie wystąpią w tym miejscu wyjątki).	
</span><span class="c1"></span>      <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="n">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">SQLException</span> <span class="n">se</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">se</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Pierwszy servlet gotowy. Gdy klikniemy <em>Run</em> -&gt; <em>Run as&hellip;</em> -&gt; <em>Run on Server</em> powinniśmy ujrzeć coś takiego:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/oldblog/20-07servlet_effect1.png"
        data-srcset="/images/oldblog/20-07servlet_effect1.png, /images/oldblog/20-07servlet_effect1.png 1.5x, /images/oldblog/20-07servlet_effect1.png 2x"
        data-sizes="auto"
        alt="/images/oldblog/20-07servlet_effect1.png"
        title="image-center" />{: .align-center}</p>
<p>Zwróćcie uwagę, że adres URL to połączony adres bazy danych oraz adresu podanego w adnotacji <code>@WebServlet</code>.</p>
<p>Czas na drugi servlet, pozwalający na dodawanie nowych wpisów do bazy. Jak widać podany adres servleta nie musi pokrywać się z nazwą klasy:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="nd">@WebServlet</span><span class="o">(</span><span class="s">&#34;/DiaryNew&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">UploadEntryServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
            <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">JDBC_DRIVER</span> <span class="o">=</span> <span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="o">;</span>
            <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DB_URL</span> <span class="o">=</span> <span class="s">&#34;jdbc:mysql://localhost:3306/diary&#34;</span><span class="o">;</span>
            <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER</span> <span class="o">=</span> <span class="s">&#34;root&#34;</span><span class="o">;</span>
            <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PASS</span> <span class="o">=</span> <span class="s">&#34;root&#34;</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Tym razem skorzystamy z żądania POST, bo inaczej cała treść wpisu w żądaniu GET musiałaby wejść w adres URL. Przesłaniamy metodę <code>doPost()</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// Tym razem pobieramy informacje z obiektu HttpServletRequest 
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">entryTitle</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;title&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;entry&#34;</span><span class="o">);</span>
        <span class="c1">// Jedna z kolumn w bazie jest typu DATETIME, potrzebujemy więc obiektu Timestamp z aktualną datą.
</span><span class="c1"></span>        <span class="n">Timestamp</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timestamp</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
        
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">JDBC_DRIVER</span><span class="o">);</span>
          
          <span class="n">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">DB_URL</span><span class="o">,</span> <span class="n">USER</span><span class="o">,</span> <span class="n">PASS</span><span class="o">);</span>
          
          <span class="c1">// Przygotowujemy dane do wysłania do bazy.
</span><span class="c1"></span>          <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&#34;INSERT INTO ENTRIES (content, date, title) values (?, ?, ?)&#34;</span><span class="o">;</span>
          <span class="n">PreparedStatement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
          <span class="n">statement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">content</span><span class="o">);</span>
          <span class="n">statement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="n">3</span><span class="o">,</span>  <span class="n">entryTitle</span><span class="o">);</span>
          <span class="n">statement</span><span class="o">.</span><span class="na">setTimestamp</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">);</span>
          
          <span class="c1">// Wysyłamy przygotowane dane do bazy i zamykamy połączenia.
</span><span class="c1"></span>          <span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
          <span class="n">statement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
          <span class="n">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">SQLException</span> <span class="n">se</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">se</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">// Po wysłaniu wpisu do bazy, przejdź pod URL pierwszego servleta i pokaż zawartość pamiętnika 
</span><span class="c1"></span>        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;DiaryArchive&#34;</span><span class="o">);</span>
      <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Gdybyśmy spróbowali odpalić ten servlet na serwerze, wyskoczy nam błąd 405. Nie wysłaliśmy bowiem żądania POST, więc sprawdzane jest (po adresie URL) żądanie GET, a tego nasz servlet nie obsługuje. Musimy przygotować plik .html do obsługi naszego servleta. Umieścimy go w projekcie w folderze <em>WebContent</em>/<em>WEB-INF</em>:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/oldblog/20-07servlet_htmlplace.png"
        data-srcset="/images/oldblog/20-07servlet_htmlplace.png, /images/oldblog/20-07servlet_htmlplace.png 1.5x, /images/oldblog/20-07servlet_htmlplace.png 2x"
        data-sizes="auto"
        alt="/images/oldblog/20-07servlet_htmlplace.png"
        title="image-center" />{: .align-center}</p>
<p>Przesyłane są informacje zawarte pomiędzy znacznikami <code>&lt;form&gt;</code> i <code>&lt;/form&gt;</code>, odzyskiwane w kodzie servleta poprzez atrybut <code>name</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML">   <span class="cp">&lt;!DOCTYPE html&gt;</span>
   <span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My Db Diary<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h3</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>Read your diary: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://localhost:8080/DiaryServlet/DiaryArchive&#34;</span><span class="p">&gt;</span>HERE<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>New Entry:<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action </span><span class="o">=</span> <span class="s">&#34;DiaryNew&#34;</span> <span class="na">method </span><span class="o">=</span> <span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
            Title: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type </span><span class="o">=</span> <span class="s">&#34;text&#34;</span> <span class="na">name </span><span class="o">=</span> <span class="s">&#34;title&#34;</span><span class="p">/&gt;</span> <span class="p">&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>
            Entry: <span class="p">&lt;</span><span class="nt">br</span><span class="p">/&gt;</span> <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">rows</span><span class="o">=</span><span class="s">&#34;20&#34;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&#34;90&#34;</span> <span class="na">wrap</span><span class="o">=</span><span class="s">&#34;hard&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;entryfield&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;entry&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;Submit&#34;</span><span class="p">/&gt;</span>
         <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Po odpaleniu zobaczymy coś takiego:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/oldblog/20-07servlet_effect2.png"
        data-srcset="/images/oldblog/20-07servlet_effect2.png, /images/oldblog/20-07servlet_effect2.png 1.5x, /images/oldblog/20-07servlet_effect2.png 2x"
        data-sizes="auto"
        alt="/images/oldblog/20-07servlet_effect2.png"
        title="image-center" />{: .align-center}</p>
<p>I to tyle! Mamy prosty (prostacki ;)) pamiętnik przetrzymywany w bazie danych, z którym łączymy się Javą poprzez serwer lokalny. Póki nie wyłączymy serwera ani bazy danych możemy łączyć się z pamiętnikiem przez dowolną przeglądarkę.</p>
<p>Pełen kod dostępny na <a href="https://github.com/MiWy/doksaprosta_blog_code_snippets/tree/master/Java101/20-07_servlets" target="_blank" rel="noopener noreffer">GitHubie</a>.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 6060-09-78</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2017-05-17-android_courier_firebase/" class="prev" rel="prev" title="[OLD] Courier App for Android"><i class="fas fa-angle-left fa-fw"></i>[OLD] Courier App for Android</a>
            <a href="/posts/2017-09-13-spotibar/" class="next" rel="next" title="[OLD] SpotiBar: Spotify &#43; Foobar">[OLD] SpotiBar: Spotify &#43; Foobar<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.92.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">mw</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
